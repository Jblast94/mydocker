version: '3.8'

services:
  # Placeholder for a GPU workload
  gpu-worker:
    image: nvidia/cuda:11.0.3-base-ubuntu20.04 # Example base image
    command: [ "nvidia-smi" ] # Just check GPU status and exit
    deploy:
      replicas: 0 # Start with 0 until we have GPU nodes
      restart_policy:
        condition: on-failure
      placement:
        constraints: [ node.labels.gpu == true ]
    networks:
      - swarm-net

  # Basic web service for testing connectivity
  whoami:
    image: traefik/whoami
    ports:
      - "8000:80"
    deploy:
      mode: replicated
      replicas: 2
    networks:
      - swarm-net

networks:
  swarm-net:
    external: true
